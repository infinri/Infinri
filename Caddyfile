# Caddy Configuration for Infinri Portfolio
{
	admin off
	
	servers {
		protocols h1 h2
		
		# Minimal timeouts
		timeouts {
			read_body 30s
			read_header 10s
			write 30s
			idle 20s
		}
		
		max_header_size 16KB
	}
	
	log {
		output discard
	}
}

# Local development
:8080 {
	root * /home/infinri/Initrix/Projects/Portfolio/pub
	
	encode gzip
	
	php_fastcgi unix//run/php/php8.4-fpm.sock
	
	file_server

	# HTML pages - no cache in development
	@html path *.php /
	header @html Cache-Control "no-store, no-cache, must-revalidate"
	
	# Versioned assets (with ?v= parameter) - long cache
	@versioned {
		path /assets/*
		query v=*
	}
	header @versioned Cache-Control "public, max-age=31536000, immutable"
	
	# Non-versioned assets - short cache for development
	@assets path /assets/*
	header @assets Cache-Control "public, max-age=60"

	header {
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}

	@hidden {
		path_regexp hidden ^/\.
	}
	respond @hidden 403
}

# Production domain (uncomment and configure when deploying)
# yourdomain.com {
#     root * /var/www/portfolio/pub
#     
#     encode zstd gzip
#     
#     php_fastcgi unix//run/php/php8.4-fpm.sock
#     
#     file_server
#     
#     @html {
#         path *.php /
#     }
#     header @html {
#         Cache-Control "no-store, no-cache, must-revalidate"
#         Pragma "no-cache"
#         Expires "Thu, 19 Nov 1981 08:52:00 GMT"
#     }
#     
#     @versioned {
#         path /assets/*
#         query v=*
#     }
#     header @versioned {
#         Cache-Control "public, max-age=31536000, immutable"
#         Vary "Accept-Encoding"
#     }
#     
#     @assets {
#         path /assets/*
#     }
#     header @assets {
#         Cache-Control "public, max-age=3600"
#         Vary "Accept-Encoding"
#     }
#     
#     header {
#         X-Content-Type-Options "nosniff"
#         X-Frame-Options "DENY"
#         Referrer-Policy "strict-origin-when-cross-origin"
#         Permissions-Policy "camera=(), microphone=(), geolocation=()"
#         -Server
#     }
#     
#     @hidden {
#         path_regexp hidden ^/\.
#     }
#     respond @hidden 403
#     
#     log {
#         output file /var/log/caddy/portfolio.log
#         format json
#         level ERROR
#     }
# }
