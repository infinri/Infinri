# Caddy Configuration for Infinri Portfolio

# Local development
:8080 {
	root * /home/infinri/Initrix/Projects/Portfolio/pub
	encode gzip zstd
	php_fastcgi unix//run/php/php8.4-fpm.sock {
		resolve_root_symlink
	}
	file_server

	# Cache headers for static assets (1 year)
	@cacheable {
		path *.css *.js *.jpg *.jpeg *.png *.gif *.svg *.webp *.woff *.woff2 *.ttf *.eot *.ico
	}
	header @cacheable {
		Cache-Control "public, max-age=31536000, immutable"
	}

	# Security headers
	header {
		# Security (CSP is set dynamically by PHP with nonce)
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "strict-origin-when-cross-origin"

		# Remove server header
		-Server
	}

	# Block access to sensitive files
	@sensitive {
		path /app/* /var/* /.* /.env /composer.* /README.md /package.json /build.js /bin/*
	}
	respond @sensitive 403

	# Logging (local dev - no sudo needed)
	log {
		output file ./var/log/caddy.log
		format json
	}
}

# Production domain (uncomment and configure when deploying)
# yourdomain.com {
#     # Caddy will automatically get SSL certificate!
#     root * /var/www/portfolio/pub
#     
#     # Same config as above
#     encode gzip zstd
#     php_fastcgi unix//run/php/php8.4-fpm.sock
#     
#     @static {
#         path /assets/* /media/* /favicon.ico /favicon.png /robots.txt
#     }
#     file_server @static
#     
#     @cacheable {
#         path *.css *.js *.jpg *.jpeg *.png *.gif *.svg *.webp *.woff *.woff2 *.ttf *.eot *.ico
#     }
#     header @cacheable {
#         Cache-Control "public, max-age=31536000, immutable"
#     }
#     
#     header {
#         X-Content-Type-Options "nosniff"
#         X-Frame-Options "DENY"
#         Referrer-Policy "strict-origin-when-cross-origin"
#         Content-Security-Policy "default-src 'self'; img-src 'self' data:; style-src 'self'; script-src 'self'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'"
#         -Server
#     }
#     
#     @sensitive {
#         path /app/* /var/* /.* /composer.* /README.md
#     }
#     respond @sensitive 403
#     
#     log {
#         output file /var/log/caddy/portfolio.log
#         format json
#     }
# }
