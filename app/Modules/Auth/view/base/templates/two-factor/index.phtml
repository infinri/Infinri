<?php
/**
 * Two-Factor Authentication Management
 * 
 * @var bool $enabled
 * @var int $recoveryCodesRemaining
 */

$this->layout('frontend/layouts/one-column');
$this->setTitle('Two-Factor Authentication');
?>

<?php $this->startBlock('head_css') ?>
<link rel="stylesheet" href="<?= $this->moduleAsset('Auth', 'base/web/css/auth.css') ?>">
<?php $this->endBlock() ?>

<?php $this->startBlock('main') ?>
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <div class="auth-icon">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
            </div>
            <h1 class="auth-title">Two-Factor Authentication</h1>
            <p class="auth-subtitle">
                <?= $enabled ? 'Your account is protected with 2FA' : 'Add an extra layer of security' ?>
            </p>
        </div>

        <?php if ($status = $this->flash('status')): ?>
            <div class="alert alert-success" role="alert">
                <?= e($status) ?>
            </div>
        <?php endif; ?>

        <?php if ($error = $this->flash('error')): ?>
            <div class="alert alert-error" role="alert">
                <?= e($error) ?>
            </div>
        <?php endif; ?>

        <div class="auth-content">
            <?php if ($enabled): ?>
                <div class="two-factor-status two-factor-status--enabled">
                    <div class="status-icon">✓</div>
                    <div class="status-text">
                        <strong>Two-factor authentication is enabled</strong>
                        <p class="auth-text">You have <?= $recoveryCodesRemaining ?> recovery codes remaining.</p>
                    </div>
                </div>

                <div class="two-factor-actions">
                    <a href="/two-factor/recovery-codes" class="btn btn-secondary btn-block">
                        View Recovery Codes
                    </a>
                    
                    <form method="POST" action="/two-factor/disable" class="auth-form">
                        <?= csrf_field() ?>
                        <button type="submit" class="btn btn-outline btn-block" 
                                onclick="return confirm('Are you sure? You will need to set up 2FA again.')">
                            Disable Two-Factor Authentication
                        </button>
                    </form>
                </div>
            <?php else: ?>
                <p class="auth-text">
                    Two-factor authentication adds an additional layer of security to your account 
                    by requiring a code from your authenticator app when you sign in.
                </p>

                <a href="/two-factor/setup" class="btn btn-primary btn-block">
                    Enable Two-Factor Authentication
                </a>
            <?php endif; ?>
        </div>

        <div class="auth-footer">
            <a href="/account" class="auth-link">← Back to account settings</a>
        </div>
    </div>
</div>
<?php $this->endBlock() ?>

<?php $this->startBlock('footer_js') ?>
<script src="<?= $this->moduleAsset('Auth', 'base/web/js/auth.js') ?>"></script>
<?php $this->endBlock() ?>
